---
phase: 08-token-consumption
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - components/Sidebar.tsx
  - components/BottomNav.tsx
  - components/BookContextModal.tsx
  - components/HighlightHistoryModal.tsx
  - components/DeleteBookModal.tsx
  - components/DeleteCardPopover.tsx
  - components/EmptyDeckPopover.tsx
  - components/ErrorBoundary.tsx
  - components/StudyHeatmap.tsx
  - components/DashboardCharts.tsx
  - components/I18nProvider.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar and BottomNav use semantic spacing and typography tokens"
    - "All 3 modals (BookContext, HighlightHistory, DeleteBook) use semantic tokens"
    - "Both popovers (DeleteCard, EmptyDeck) use semantic tokens"
    - "ErrorBoundary uses semantic tokens including text-destructive for error colors"
    - "StudyHeatmap spacing/typography migrated; data-viz colors preserved as intentional deviations"
    - "DashboardCharts spacing/typography migrated; hsl() bug left for Phase 10"
    - "All 11 components build without errors"
  artifacts:
    - path: "components/Sidebar.tsx"
      provides: "Sidebar with semantic tokens"
      contains: "p-md|gap-sm|text-body"
    - path: "components/ErrorBoundary.tsx"
      provides: "Error boundary with semantic destructive color tokens"
      contains: "text-destructive"
    - path: "components/BookContextModal.tsx"
      provides: "Book context modal with semantic tokens"
      contains: "p-md|gap-sm|text-body|text-caption"
  key_links:
    - from: "tailwind.config.js colors.destructive"
      to: "components/ErrorBoundary.tsx"
      via: "destructive color token"
      pattern: "text-destructive|bg-destructive"
---

<objective>
Migrate remaining 11 components (navigation, modals, popovers, error boundary, data visualization) from raw Tailwind values to semantic design tokens, plus run a final comprehensive audit across all files.

Purpose: Completes component migration and ensures zero raw values remain across the entire in-scope codebase.
Output: All non-UI components use semantic tokens. Final audit confirms phase success criteria met.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-token-consumption/08-RESEARCH.md
@tailwind.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate navigation, modals, and popovers to semantic tokens</name>
  <files>components/Sidebar.tsx, components/BottomNav.tsx, components/BookContextModal.tsx, components/HighlightHistoryModal.tsx, components/DeleteBookModal.tsx, components/DeleteCardPopover.tsx, components/EmptyDeckPopover.tsx</files>
  <action>
Migrate 7 components from raw values to semantic tokens. All are low-to-medium complexity.

**Sidebar.tsx (~153 lines, ~8 spacing, ~5 typography, ~2 colors):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`
- `text-base` at logo text (~line 50) -> KEEP `text-base` (brand text, intentional)
- Colors: `bg-blue-600` (avatar) -> `bg-primary`

**BottomNav.tsx (~34 lines, ~2 spacing, ~1 typography, 0 colors):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`

**BookContextModal.tsx (~121 lines, ~10 spacing, ~8 typography, 0 colors):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`

**HighlightHistoryModal.tsx (~131 lines, ~5 spacing, ~8 typography, 0 colors):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`
- Note: hsl(var(--...)) bug exists in this file. Do NOT touch JavaScript inline styles. Only migrate Tailwind className strings.

**DeleteBookModal.tsx (~109 lines, ~3 spacing, ~2 typography, 0 colors):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`

**DeleteCardPopover.tsx (~47 lines, ~1 spacing, ~3 typography, 0 colors):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`

**EmptyDeckPopover.tsx (~41 lines, ~1 spacing, ~2 typography, ~1 color):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`
- Colors: `text-green-*` -> `text-success` if applicable

**Sub-4px (KEEP raw):** gap-0.5, py-0.5 stay as-is across all files.
  </action>
  <verify>
Run grep checks across all 7 files:
- `grep -nP "\b(p|px|py|pt|pb|pl|pr|m|mx|my|mt|mb|ml|mr|gap|space-[xy])-[0-9]" components/Sidebar.tsx components/BottomNav.tsx components/BookContextModal.tsx components/HighlightHistoryModal.tsx components/DeleteBookModal.tsx components/DeleteCardPopover.tsx components/EmptyDeckPopover.tsx` -- only sub-4px (0.5) allowed
- `grep -n "text-\(sm\|xs\|base\)" components/Sidebar.tsx components/BottomNav.tsx components/BookContextModal.tsx components/HighlightHistoryModal.tsx components/DeleteBookModal.tsx components/DeleteCardPopover.tsx components/EmptyDeckPopover.tsx` -- only Sidebar logo text-base allowed
- `npm run build` succeeds
  </verify>
  <done>All 7 components use semantic tokens. Navigation, modals, and popovers migrated. Zero raw spacing/typography remains (except Sidebar logo text-base and sub-4px micro-spacing).</done>
</task>

<task type="auto">
  <name>Task 2: Migrate error/data-viz components and run final audit</name>
  <files>components/ErrorBoundary.tsx, components/StudyHeatmap.tsx, components/DashboardCharts.tsx, components/I18nProvider.tsx</files>
  <action>
Migrate 4 remaining components, then run a comprehensive audit of ALL in-scope files.

**ErrorBoundary.tsx (~64 lines, ~3 spacing, ~3 typography, ~3 colors):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`
- Colors:
  - `text-red-500` -> `text-destructive`
  - `text-red-600` -> `text-destructive`
  - `bg-red-50` -> `bg-destructive/10` (Tailwind opacity modifier)

**StudyHeatmap.tsx (~392 lines, ~5 spacing, ~3 typography, ~8 colors with deviations):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`
- Colors (DEVIATIONS -- see Research):
  - Heatmap gradient: `bg-green-200`, `bg-green-300`, `bg-green-400`, `bg-green-500`, `bg-green-600` -> KEEP raw (data visualization gradient, not semantic UI)
  - Tooltip: `bg-zinc-900 dark:bg-zinc-100` -> KEEP raw (inverted tooltip, component-internal)
  - Tooltip subtext: `text-zinc-300 dark:text-zinc-600` -> KEEP raw (component-internal)
  - Streak icon: `text-orange-500` -> KEEP raw (data viz accent)
  - Add comment above each kept deviation: `{/* data-viz: intentional raw color */}`

**DashboardCharts.tsx (~54 lines, ~3 spacing, ~2 typography, ~15 colors via hsl):**
- Spacing: Standard mapping
- Typography: `text-xs` -> `text-caption`, `text-sm` -> `text-body`
- Colors: The ~15 color references are hsl(var(--...)) in JavaScript/Recharts inline styles. Do NOT touch these -- they are the Phase 10 hsl/oklch bug. Only migrate Tailwind className strings.

**I18nProvider.tsx (~28 lines, 0 spacing, ~1 typography, 0 colors):**
- Typography: `text-xs` -> `text-caption` or `text-sm` -> `text-body` (whichever is present)
- Minimal file, likely only 1 replacement

**FINAL AUDIT (after all 4 files migrated):**

Run comprehensive grep across ALL in-scope files to verify phase completion:

```bash
# Spacing audit - all pages
grep -rnP "\b(p|px|py|pt|pb|pl|pr|m|mx|my|mt|mb|ml|mr|gap|space-[xy])-[0-9]" pages/

# Spacing audit - all components (excluding ui/)
grep -nP "\b(p|px|py|pt|pb|pl|pr|m|mx|my|mt|mb|ml|mr|gap|space-[xy])-[0-9]" components/[A-Z]*.tsx components/[a-z]*.tsx

# Typography audit - all pages
grep -rn "text-sm\|text-xs\|text-base\|text-lg" pages/

# Typography audit - all components (excluding ui/)
grep -n "text-sm\|text-xs\|text-base\|text-lg" components/[A-Z]*.tsx components/[a-z]*.tsx

# Color audit - all pages
grep -rnP "\b(text|bg|border)-(zinc|gray|red|amber|blue|green|yellow|orange)-[0-9]+" pages/

# Color audit - all components (excluding ui/)
grep -nP "\b(text|bg|border)-(zinc|gray|red|amber|blue|green|yellow|orange)-[0-9]+" components/[A-Z]*.tsx components/[a-z]*.tsx
```

Document any remaining raw values with justification (should only be: sub-4px micro-spacing, StudySession deviations, StudyHeatmap data-viz, above-scale values, tag tinted hovers, Sidebar logo).
  </action>
  <verify>
1. `npm run build` succeeds
2. Final audit grep results show ONLY documented exceptions:
   - Sub-4px (0.5) micro-spacing
   - StudySession rating buttons (bg-red/amber/blue/green-500)
   - StudySession serif text (text-lg md:text-xl)
   - StudySession display sizes (text-2xl, text-4xl)
   - StudyHeatmap gradient + tooltip colors
   - Tag tinted hover backgrounds (if kept)
   - Sidebar logo text-base
   - StudySession textarea text-base
   - Above-scale values (py-20)
3. All other raw values eliminated
  </verify>
  <done>All 4 remaining components migrated. Comprehensive audit confirms phase success criteria: zero raw numeric spacing (except sub-4px), zero raw text-sm/text-xs, zero raw colors (except documented deviations). Build succeeds.</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes
2. Comprehensive audit covers all 6 pages + all non-UI components
3. All raw values either replaced or documented as intentional deviations
4. Phase 8 success criteria from ROADMAP.md satisfied:
   - All pages use semantic spacing tokens (p-sm, gap-md, mb-lg) instead of raw numeric
   - All status/tag/success colors use semantic tokens where possible
   - All remaining raw text-sm/text-xs replaced with text-body/text-caption
</verification>

<success_criteria>
- ErrorBoundary uses text-destructive and bg-destructive/10
- StudyHeatmap data-viz colors preserved with comments
- DashboardCharts hsl bug untouched (deferred to Phase 10)
- Final audit shows zero unexpected raw values across entire codebase
- Build succeeds
- Phase 8 complete
</success_criteria>

<output>
After completion, create `.planning/phases/08-token-consumption/08-05-SUMMARY.md`
</output>
