---
phase: 08-token-consumption
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - pages/StudySession.tsx
  - pages/Study.tsx
autonomous: true

must_haves:
  truths:
    - "StudySession uses semantic spacing tokens for all layout spacing (padding, gaps, margins)"
    - "StudySession uses semantic typography tokens for all non-deviation text"
    - "StudySession status dots use bg-status-new/learning/review instead of raw bg-blue/amber/green-500"
    - "StudySession rating buttons KEEP raw colors (intentional deviation -- SM-2 quality feedback)"
    - "StudySession serif text (text-lg md:text-xl font-serif) is UNCHANGED (intentional deviation)"
    - "StudySession completion stats (text-2xl, text-4xl) are UNCHANGED (no token exists)"
    - "Study page has zero raw numeric spacing, typography, or color values"
  artifacts:
    - path: "pages/StudySession.tsx"
      provides: "StudySession with semantic tokens and preserved intentional deviations"
      contains: "bg-status-new|bg-status-learning|bg-status-review|p-md|text-body"
    - path: "pages/Study.tsx"
      provides: "Study page with full semantic token consumption"
      contains: "p-md|gap-sm|text-body|text-caption"
  key_links:
    - from: "tailwind.config.js colors.status"
      to: "pages/StudySession.tsx"
      via: "status color tokens replacing raw bg-blue/amber/green-500"
      pattern: "bg-status-(new|learning|review)"
---

<objective>
Migrate StudySession.tsx and Study.tsx from raw Tailwind values to semantic design tokens, carefully preserving StudySession's intentional deviations.

Purpose: StudySession is the most complex page (~90 raw values, many intentional deviations). Study is medium (~22 values). This plan handles the trickiest file in the codebase.
Output: Both pages use semantic tokens everywhere possible. StudySession's documented deviations (rating buttons, serif text, large stats) are explicitly preserved.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-token-consumption/08-RESEARCH.md
@tailwind.config.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate StudySession.tsx to semantic tokens (with deviation preservation)</name>
  <files>pages/StudySession.tsx</files>
  <action>
Replace raw Tailwind values in StudySession.tsx with semantic equivalents. This file has MANY intentional deviations that MUST be preserved.

**REPLACE (spacing, typography, non-deviation colors):**

Spacing: Apply standard mapping (1->xxs, 2->xs, 3->sm, 4->md, 5->lg, 6->lg, 8->xl, etc.). Migrate all raw numeric spacing to semantic tokens. Keep sub-4px (0.5) raw.

Typography:
- `text-xs` -> `text-caption`
- `text-sm` -> `text-body`
- `text-base` at line ~282 (loading message) -> `text-body`
- `text-base` at line ~336 (error message) -> `text-body`
- `text-base` at line ~531 (textarea) -> KEEP `text-base` (input field readability)

Colors (REPLACE these):
- Status dots: `bg-blue-500` -> `bg-status-new`, `bg-amber-500` -> `bg-status-learning`, `bg-green-500` -> `bg-status-review`
- Any `text-green-600 dark:text-green-400` -> `text-success`
- Any `text-red-*` error text -> `text-destructive`

**DO NOT REPLACE (intentional deviations):**

1. Rating buttons (lines ~636-660): `bg-red-500 dark:bg-red-600`, `bg-amber-500 dark:bg-amber-600`, `bg-blue-500 dark:bg-blue-600`, `bg-green-500 dark:bg-green-600` -- these are SM-2 quality feedback colors, NOT status tokens.

2. Serif reading text (line ~540): `text-lg md:text-xl font-serif` -- immersive reading experience.

3. Serif note display (line ~586): `text-lg md:text-xl font-serif` -- same.

4. Completion stats: `text-2xl`, `text-4xl` -- no semantic token exists for these display sizes. Keep raw.

5. `text-xl` occurrences in responsive pairs like `md:text-xl` -- no 20px token exists, keep raw.

**Responsive pairs:** Always migrate BOTH base and responsive variant. Example: `p-3 sm:p-4` -> `p-sm sm:p-md`. But if the responsive target is a deviation (like `md:text-xl`), keep the entire responsive pair as-is.
  </action>
  <verify>
Run these grep checks:
- `grep -nP "\b(p|px|py|pt|pb|pl|pr|m|mx|my|mt|mb|ml|mr|gap|space-[xy])-[0-9]" pages/StudySession.tsx` -- only sub-4px (0.5) values allowed
- `grep -n "text-sm\|text-xs" pages/StudySession.tsx` -- zero matches
- `grep -n "text-base" pages/StudySession.tsx` -- only textarea line (~531) allowed
- `grep -nP "bg-(blue|amber|green)-500" pages/StudySession.tsx` -- only rating button lines (~636-660) allowed
- `grep -n "bg-status-" pages/StudySession.tsx` -- should show status dot replacements
- `grep -n "font-serif" pages/StudySession.tsx` -- should still exist (preserved deviation)
- `npm run build` succeeds
  </verify>
  <done>StudySession.tsx uses semantic tokens for all non-deviation values. Status dots use bg-status-new/learning/review. Rating buttons, serif text, and large stats are preserved unchanged. Zero raw spacing remains (except sub-4px). Zero raw text-sm/text-xs remains.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Study.tsx to semantic tokens</name>
  <files>pages/Study.tsx</files>
  <action>
Replace ALL raw Tailwind values in Study.tsx with semantic equivalents.

Study.tsx is ~131 lines with ~22 raw values. Apply standard mappings:

**Spacing:** All numeric spacing -> semantic tokens (same mapping as Plan 01).

**Typography:**
- `text-xs` -> `text-caption`
- `text-sm` -> `text-body`
- `text-lg` -> `text-heading`

**Colors:**
- `text-blue-*` / `text-amber-*` / `text-green-*` in deck stats context -> test `text-status-new` / `text-status-learning` / `text-status-review`. If Tailwind resolves `text-status-*` correctly (it should since status colors are under `colors.status.*`), use them. If not, keep raw and document.
- `bg-blue-500` / `bg-amber-500` / `bg-green-500` (status indicators) -> `bg-status-new` / `bg-status-learning` / `bg-status-review`

**Sub-4px (KEEP raw):** gap-0.5, py-0.5, etc. stay as-is.
  </action>
  <verify>
Run these grep checks:
- `grep -nP "\b(p|px|py|pt|pb|pl|pr|m|mx|my|mt|mb|ml|mr|gap|space-[xy])-[0-9]" pages/Study.tsx` -- only sub-4px (0.5) allowed
- `grep -n "text-\(sm\|xs\|base\|lg\)" pages/Study.tsx` -- zero matches
- `grep -nP "\b(text|bg|border)-(blue|amber|green)-[0-9]+" pages/Study.tsx` -- zero matches (status colors replaced)
- `npm run build` succeeds
  </verify>
  <done>Study.tsx uses only semantic tokens. Status colors use semantic tokens. Zero raw spacing, typography, or color values remain (except sub-4px micro-spacing).</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. `npm run build` passes with no new errors
2. StudySession intentional deviations are intact: rating button raw colors, serif text, large display sizes
3. StudySession status dots use semantic tokens (bg-status-new, bg-status-learning, bg-status-review)
4. Study.tsx has zero raw values
5. Grep confirms semantic tokens present in both files
</verification>

<success_criteria>
- StudySession.tsx: ~35 spacing + ~25 typography + ~5 color replacements completed, deviations preserved
- Study.tsx: ~15 spacing + ~10 typography + ~5 color replacements completed
- Zero raw values remain in either file except documented deviations and sub-4px micro-spacing
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/08-token-consumption/08-02-SUMMARY.md`
</output>
