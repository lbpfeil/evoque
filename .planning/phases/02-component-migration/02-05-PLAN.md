---
phase: 02-component-migration
plan: 05
type: execute
wave: 3
depends_on: ["02-01"]
files_modified:
  - components/ui/alert-dialog.tsx
  - components/DeleteBookModal.tsx
  - components/DeleteCardPopover.tsx
  - components/EmptyDeckPopover.tsx
autonomous: true

must_haves:
  truths:
    - "AlertDialog component is installed and available"
    - "DeleteBookModal uses shadcn AlertDialog pattern"
    - "DeleteCardPopover uses shadcn AlertDialog pattern"
    - "EmptyDeckPopover uses shadcn AlertDialog pattern"
    - "All confirmation dialogs render correctly in both light and dark mode"
  artifacts:
    - path: "components/ui/alert-dialog.tsx"
      provides: "shadcn AlertDialog component"
      exports: ["AlertDialog", "AlertDialogAction", "AlertDialogCancel", "AlertDialogContent"]
    - path: "components/DeleteBookModal.tsx"
      provides: "Delete book confirmation with AlertDialog"
      contains: "AlertDialogContent"
    - path: "components/DeleteCardPopover.tsx"
      provides: "Delete card confirmation with AlertDialog"
      contains: "AlertDialogContent"
    - path: "components/EmptyDeckPopover.tsx"
      provides: "Empty deck notification with AlertDialog"
      contains: "AlertDialogContent"
  key_links:
    - from: "components/DeleteBookModal.tsx"
      to: "components/ui/alert-dialog"
      via: "import statement"
      pattern: "from.*ui/alert-dialog"
---

<objective>
Install shadcn AlertDialog and migrate confirmation modals (DeleteBookModal, DeleteCardPopover, EmptyDeckPopover) to use it.

Purpose: Replace custom modal implementations with shadcn AlertDialog for consistent styling, accessibility (focus trapping, ESC handling), and theme awareness.

Output: Three confirmation modals using shadcn AlertDialog pattern with proper accessibility and theme support.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-component-migration/02-RESEARCH.md

# Modals to migrate
@components/DeleteBookModal.tsx
@components/DeleteCardPopover.tsx
@components/EmptyDeckPopover.tsx

# Checkbox component (for DeleteBookModal)
@components/ui/checkbox.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install shadcn AlertDialog component</name>
  <files>components/ui/alert-dialog.tsx</files>
  <action>
  Run the shadcn CLI to install AlertDialog:
  ```bash
  npx shadcn@latest add alert-dialog
  ```

  After installation, verify the file exists at `components/ui/alert-dialog.tsx`.

  If the installed component has hardcoded zinc-* colors, apply semantic token fixes:
  - `bg-white dark:bg-zinc-900` -> `bg-background`
  - `border-zinc-200 dark:border-zinc-800` -> `border-border`
  - `text-zinc-900 dark:text-zinc-100` -> `text-foreground`
  - `text-zinc-600 dark:text-zinc-400` -> `text-muted-foreground`
  - Remove all `dark:` prefixes after replacing with semantic tokens

  The AlertDialog should export:
  - AlertDialog
  - AlertDialogPortal
  - AlertDialogOverlay
  - AlertDialogTrigger
  - AlertDialogContent
  - AlertDialogHeader
  - AlertDialogFooter
  - AlertDialogTitle
  - AlertDialogDescription
  - AlertDialogAction
  - AlertDialogCancel
  </action>
  <verify>
  - File exists: `ls components/ui/alert-dialog.tsx`
  - Exports exist: `grep -E "export.*AlertDialog" components/ui/alert-dialog.tsx`
  - No hardcoded colors: `grep -c "zinc-" components/ui/alert-dialog.tsx` returns 0
  </verify>
  <done>
  - AlertDialog component installed at components/ui/alert-dialog.tsx
  - Component uses semantic tokens
  - All required exports available
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate DeleteBookModal to AlertDialog</name>
  <files>components/DeleteBookModal.tsx</files>
  <action>
  Replace the entire component implementation with shadcn AlertDialog pattern:

  ```tsx
  import React, { useState, useMemo } from 'react';
  import { AlertTriangle } from 'lucide-react';
  import { useStore } from './StoreContext';
  import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogCancel,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
  } from './ui/alert-dialog';
  import { Checkbox } from './ui/checkbox';

  interface DeleteBookModalProps {
    bookId: string | null;
    onConfirm: () => void;
    onCancel: () => void;
  }

  export const DeleteBookModal: React.FC<DeleteBookModalProps> = ({ bookId, onConfirm, onCancel }) => {
    const { getBook, highlights, studyCards, currentSession } = useStore();
    const [confirmed, setConfirmed] = useState(false);

    const bookData = useMemo(() => {
      if (!bookId) return null;

      const book = getBook(bookId);
      if (!book) return null;

      const bookHighlights = highlights.filter(h => h.bookId === bookId);
      const highlightIds = bookHighlights.map(h => h.id);
      const bookCards = studyCards.filter(c => highlightIds.includes(c.highlightId));
      const isInActiveSession = currentSession?.bookId === bookId;

      return {
        book,
        highlightCount: bookHighlights.length,
        cardCount: bookCards.length,
        isInActiveSession
      };
    }, [bookId, getBook, highlights, studyCards, currentSession]);

    // Reset confirmed state when modal opens/closes
    React.useEffect(() => {
      if (!bookId) {
        setConfirmed(false);
      }
    }, [bookId]);

    if (!bookData) return null;

    return (
      <AlertDialog open={!!bookId} onOpenChange={(open) => !open && onCancel()}>
        <AlertDialogContent>
          <AlertDialogHeader>
            <AlertDialogTitle className="flex items-center gap-2">
              <AlertTriangle className="w-5 h-5 text-destructive" />
              Delete "{bookData.book.title}"?
            </AlertDialogTitle>
            <AlertDialogDescription asChild>
              <div className="space-y-2">
                <p>This action will permanently delete:</p>
                <ul className="list-disc list-inside ml-2 space-y-1">
                  <li>{bookData.highlightCount} highlight{bookData.highlightCount !== 1 ? 's' : ''}</li>
                  <li>{bookData.cardCount} study card{bookData.cardCount !== 1 ? 's' : ''}</li>
                  <li>All review history for this book</li>
                  <li>All chapter tags associated with this book</li>
                </ul>
                {bookData.isInActiveSession && (
                  <p className="text-destructive font-medium mt-3 flex items-center gap-1">
                    <AlertTriangle className="w-3 h-3" />
                    This book is in your active study session
                  </p>
                )}
              </div>
            </AlertDialogDescription>
          </AlertDialogHeader>

          <div className="flex items-center gap-2 py-2">
            <Checkbox
              id="confirm-delete"
              checked={confirmed}
              onCheckedChange={(checked) => setConfirmed(!!checked)}
            />
            <label htmlFor="confirm-delete" className="text-sm text-muted-foreground cursor-pointer">
              I understand this action cannot be undone
            </label>
          </div>

          <AlertDialogFooter>
            <AlertDialogCancel>Cancel</AlertDialogCancel>
            <AlertDialogAction
              onClick={onConfirm}
              disabled={!confirmed}
              className="bg-destructive text-destructive-foreground hover:bg-destructive/90 disabled:opacity-50"
            >
              Delete Book
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    );
  };

  export default DeleteBookModal;
  ```
  </action>
  <verify>
  - Run: `npm run build` (no errors)
  - Grep: `grep -c "zinc-" components/DeleteBookModal.tsx` returns 0
  - Grep: `grep "AlertDialog" components/DeleteBookModal.tsx` shows imports and usage
  </verify>
  <done>
  - DeleteBookModal uses shadcn AlertDialog
  - Preserves all functionality (checkbox confirmation, book data display)
  - Uses semantic tokens
  - Has proper accessibility (focus trapping, ESC to close)
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate DeleteCardPopover and EmptyDeckPopover to AlertDialog</name>
  <files>components/DeleteCardPopover.tsx, components/EmptyDeckPopover.tsx</files>
  <action>
  **DeleteCardPopover.tsx - Replace entire implementation:**

  ```tsx
  import React from 'react';
  import { AlertTriangle } from 'lucide-react';
  import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogCancel,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
  } from './ui/alert-dialog';

  interface DeleteCardPopoverProps {
    open: boolean;
    onConfirm: () => void;
    onCancel: () => void;
  }

  export const DeleteCardPopover: React.FC<DeleteCardPopoverProps> = ({ open, onConfirm, onCancel }) => {
    return (
      <AlertDialog open={open} onOpenChange={(isOpen) => !isOpen && onCancel()}>
        <AlertDialogContent className="max-w-xs">
          <AlertDialogHeader>
            <AlertDialogTitle className="flex items-center gap-2 text-sm">
              <AlertTriangle className="w-4 h-4 text-destructive" />
              Delete this card?
            </AlertDialogTitle>
            <AlertDialogDescription className="text-xs">
              This will remove the card from your study system. This action cannot be undone.
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogCancel className="text-xs">Cancel</AlertDialogCancel>
            <AlertDialogAction
              onClick={onConfirm}
              className="bg-destructive text-destructive-foreground hover:bg-destructive/90 text-xs"
            >
              Delete
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    );
  };
  ```

  **Note:** The props interface changed from `{ onConfirm, onCancel }` to `{ open, onConfirm, onCancel }`. Check all usages of DeleteCardPopover and update them to pass the `open` prop. If this breaks too many places, you can keep the original pattern:

  ```tsx
  // Alternative: Keep original pattern if open prop breaks things
  export const DeleteCardPopover: React.FC<{ onConfirm: () => void; onCancel: () => void }> = ({ onConfirm, onCancel }) => {
    return (
      <AlertDialog open={true} onOpenChange={(isOpen) => !isOpen && onCancel()}>
        {/* ... */}
      </AlertDialog>
    );
  };
  ```

  **EmptyDeckPopover.tsx - Replace entire implementation:**

  ```tsx
  import React from 'react';
  import { AlertCircle } from 'lucide-react';
  import {
    AlertDialog,
    AlertDialogAction,
    AlertDialogContent,
    AlertDialogDescription,
    AlertDialogFooter,
    AlertDialogHeader,
    AlertDialogTitle,
  } from './ui/alert-dialog';

  interface EmptyDeckPopoverProps {
    open: boolean;
    onClose: () => void;
  }

  export const EmptyDeckPopover: React.FC<EmptyDeckPopoverProps> = ({ open, onClose }) => {
    return (
      <AlertDialog open={open} onOpenChange={(isOpen) => !isOpen && onClose()}>
        <AlertDialogContent className="max-w-xs">
          <AlertDialogHeader>
            <AlertDialogTitle className="flex items-center gap-2 text-sm">
              <AlertCircle className="w-4 h-4 text-amber-500" />
              No cards available
            </AlertDialogTitle>
            <AlertDialogDescription className="text-xs">
              All reviews for this deck are completed today. Come back tomorrow for more!
            </AlertDialogDescription>
          </AlertDialogHeader>
          <AlertDialogFooter>
            <AlertDialogAction onClick={onClose} className="text-xs">
              Got it
            </AlertDialogAction>
          </AlertDialogFooter>
        </AlertDialogContent>
      </AlertDialog>
    );
  };
  ```

  **Note:** Same props change consideration applies. Keep original pattern if needed:
  ```tsx
  export const EmptyDeckPopover: React.FC<{ onClose: () => void }> = ({ onClose }) => {
    return (
      <AlertDialog open={true} onOpenChange={(isOpen) => !isOpen && onClose()}>
        {/* ... */}
      </AlertDialog>
    );
  };
  ```

  **Update any usages in other files** if you changed the props interface. Search for:
  - `<DeleteCardPopover`
  - `<EmptyDeckPopover`
  </action>
  <verify>
  - Run: `npm run build` (no errors)
  - Grep: `grep -c "zinc-" components/DeleteCardPopover.tsx components/EmptyDeckPopover.tsx` returns 0
  - Grep: `grep "AlertDialog" components/DeleteCardPopover.tsx components/EmptyDeckPopover.tsx` shows imports
  </verify>
  <done>
  - DeleteCardPopover uses shadcn AlertDialog
  - EmptyDeckPopover uses shadcn AlertDialog
  - Both use semantic tokens
  - Both have proper accessibility
  - All usages updated if props changed
  </done>
</task>

</tasks>

<verification>
Run after all tasks complete:

```bash
# Verify AlertDialog installed
ls components/ui/alert-dialog.tsx

# Verify no hardcoded colors
grep -rn "zinc-" components/DeleteBookModal.tsx components/DeleteCardPopover.tsx components/EmptyDeckPopover.tsx components/ui/alert-dialog.tsx

# Expected: No output

# Verify AlertDialog usage
grep -l "AlertDialog" components/DeleteBookModal.tsx components/DeleteCardPopover.tsx components/EmptyDeckPopover.tsx

# Expected: All three files listed

# Build check
npm run build

# Visual verification
npm run dev
# Test DeleteBookModal: Go to Settings -> Library -> Delete a book
# Test DeleteCardPopover: During study session, try to delete a card
# Test EmptyDeckPopover: Start study with deck that has no due cards
# Toggle theme during each test
```
</verification>

<success_criteria>
- AlertDialog component installed and uses semantic tokens
- DeleteBookModal uses AlertDialog with Checkbox for confirmation
- DeleteCardPopover uses AlertDialog
- EmptyDeckPopover uses AlertDialog
- All three modals render correctly in light and dark mode
- All modals have proper accessibility (focus trap, ESC to close)
- No TypeScript errors on build
</success_criteria>

<output>
After completion, create `.planning/phases/02-component-migration/02-05-SUMMARY.md`
</output>
