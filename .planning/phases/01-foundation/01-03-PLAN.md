---
phase: 01-foundation
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - App.tsx
  - components/Sidebar.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Sidebar displays beside page content, not overlapping it"
    - "Theme toggle does not overlap StudySession footer buttons"
    - "Theme toggle accessible from Sidebar when expanded"
    - "Layout works correctly on both mobile and desktop"
  artifacts:
    - path: "App.tsx"
      provides: "Layout without fixed theme toggle conflicting with StudySession"
      contains: "isStudySession"
    - path: "components/Sidebar.tsx"
      provides: "ThemeToggle integrated in sidebar"
      contains: "ThemeToggle"
  key_links:
    - from: "App.tsx"
      to: "components/Sidebar.tsx"
      via: "Sidebar contains ThemeToggle, AppLayout hides global toggle on StudySession"
      pattern: "isStudySession.*ThemeToggle"
---

<objective>
Fix layout issues: sidebar overlapping pages (GAP-01) and theme toggle overlapping StudySession buttons (GAP-05).

Purpose: Users reported the sidebar appears on top of page content and the theme toggle covers buttons in StudySession. These layout bugs prevent normal use of the app.

Output: Sidebar displays correctly beside content, theme toggle integrated into Sidebar and not shown in StudySession.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@App.tsx
@components/Sidebar.tsx
@pages/StudySession.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix sidebar and main content layout</name>
  <files>App.tsx, components/Sidebar.tsx</files>
  <action>
**Problem:** The sidebar has `position: fixed` and width `w-14` (collapsed) / `w-56` (expanded), but main content only has `md:ml-14` margin. When sidebar is expanded, it may overlap.

**Fix in App.tsx AppLayout:**

1. The main content should have dynamic margin matching sidebar state. However, since the sidebar auto-expands on hover, we keep `md:ml-14` (matching collapsed w-14 = 56px = 3.5rem) as the base margin. The sidebar expands OVER content on hover (overlay behavior), which is intentional.

2. Verify the sidebar's z-index doesn't cause issues. Current z-50 is correct.

3. The actual issue might be that on some screen sizes the sidebar is not getting proper stacking. Ensure the sidebar has `md:flex` and is `hidden` on mobile (already done). The main content should fill remaining space.

**Review current values:**
- Sidebar collapsed: w-14 (56px)
- Main content margin: md:ml-14 (56px)
- These match, so the base layout should work.

**Potential fix:** If the sidebar appears "on top" visually, it may be a background transparency issue. Ensure:
- Sidebar has solid background: Currently `bg-white dark:bg-zinc-900`
- These are hardcoded colors, should use semantic tokens for consistency

**Update Sidebar.tsx line 36:**
Change:
```tsx
className={`fixed inset-y-0 left-0 ${isExpanded ? 'w-56' : 'w-14'} bg-white dark:bg-zinc-900 border-r border-zinc-200 dark:border-zinc-800 ...`}
```
To use semantic colors:
```tsx
className={`fixed inset-y-0 left-0 ${isExpanded ? 'w-56' : 'w-14'} bg-sidebar border-r border-sidebar-border text-sidebar-foreground ...`}
```

Also update other hardcoded colors in Sidebar.tsx to use semantic tokens:
- `border-zinc-100 dark:border-zinc-800` -> `border-sidebar-border`
- `bg-zinc-100 dark:bg-zinc-800` -> `bg-sidebar-accent`
- `text-zinc-900 dark:text-zinc-100` -> `text-sidebar-foreground`
- `text-zinc-500 dark:text-zinc-400` -> `text-muted-foreground`
- `hover:bg-zinc-50 dark:hover:bg-zinc-800` -> `hover:bg-sidebar-accent`
- `bg-black dark:bg-white` (logo) -> keep as-is (intentional contrast)
- `text-white dark:text-black` (logo) -> keep as-is (intentional contrast)
  </action>
  <verify>
1. Run `npm run dev` and check sidebar displays beside content
2. Sidebar should have solid background matching the theme
3. Hover over sidebar to expand - it should overlay content smoothly
4. Check both light and dark mode
  </verify>
  <done>Sidebar uses semantic color tokens and displays correctly beside main content</done>
</task>

<task type="auto">
  <name>Task 2: Move ThemeToggle out of global position, hide on StudySession</name>
  <files>App.tsx</files>
  <action>
**Problem:** The ThemeToggle is in a fixed position at bottom-right corner (`fixed bottom-4 right-4 z-50`) in AppLayout. This overlaps with StudySession's fixed footer buttons.

**Fix:**

1. In AppLayout, conditionally render the global ThemeToggle only when NOT on StudySession:

Change from:
```tsx
<div className="fixed bottom-4 right-4 z-50">
  <ThemeToggle />
</div>
```

To:
```tsx
{!isStudySession && (
  <div className="fixed bottom-4 right-4 z-50">
    <ThemeToggle />
  </div>
)}
```

2. The Sidebar already has a ThemeToggle (line 92-97 in Sidebar.tsx), so users on desktop can still access it there. On mobile without sidebar, they can access theme toggle on other pages.

3. StudySession is a focused study interface - not having theme toggle during study is acceptable UX (users can exit to change theme).
  </action>
  <verify>
1. Navigate to StudySession (`/study/session`) - no theme toggle should appear at bottom-right
2. Navigate to any other page - theme toggle should appear at bottom-right
3. On desktop, expand sidebar - theme toggle should be visible in sidebar
  </verify>
  <done>Theme toggle hidden on StudySession page, preventing overlap with footer buttons</done>
</task>

</tasks>

<verification>
After both tasks complete:
1. Run `npm run dev`
2. Navigate to Dashboard - sidebar should be beside content, theme toggle at bottom-right
3. Expand sidebar on hover - content should remain readable
4. Navigate to StudySession - no theme toggle at bottom-right, footer buttons unobstructed
5. Toggle theme from sidebar (when expanded) - should work
6. Check both light and dark mode
</verification>

<success_criteria>
- Sidebar uses semantic color tokens (bg-sidebar, text-sidebar-foreground, etc.)
- Sidebar displays beside content without overlapping
- Theme toggle hidden on StudySession page
- Theme toggle accessible via sidebar or other pages
- Both light and dark mode work correctly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`
</output>
