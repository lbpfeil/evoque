---
phase: 12-studysession-ux
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - pages/StudySession.tsx
autonomous: true

must_haves:
  truths:
    - "When editing highlight, text stays in same position with same font/size"
    - "When editing note, text stays in same position with same font/size"
    - "Textarea auto-resizes to fit content (no fixed height)"
    - "Edit mode has subtle visual indicator without jarring container change"
  artifacts:
    - path: "pages/StudySession.tsx"
      provides: "Seamless inline editing"
      contains: "bg-transparent"
  key_links:
    - from: "isEditingHighlight textarea"
      to: "blockquote"
      via: "matching classes"
      pattern: "text-lg md:text-xl font-serif italic"
    - from: "isEditingNote textarea"
      to: "note div"
      via: "matching classes"
      pattern: "text-lg md:text-xl font-serif"
---

<objective>
Implement seamless inline editing for highlights and notes: textareas visually match their display counterparts with auto-resize and subtle edit indicators.

Purpose: Eliminate the jarring visual transition when entering edit mode. Text should appear to stay in place -- only the cursor indicates edit mode.
Output: Updated StudySession.tsx with STUDY-04 requirement satisfied.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/12-studysession-ux/12-RESEARCH.md
@pages/StudySession.tsx
@lbp_diretrizes/design-system-guide.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement seamless highlight editing</name>
  <files>pages/StudySession.tsx</files>
  <action>
Find the highlight editing section (around lines 527-562).

**Current implementation (jarring container change):**
```tsx
{isEditingHighlight ? (
    <div className="bg-muted border border-border rounded-md p-md">
        <div className="flex items-center justify-between mb-xs">
            <span className="text-overline uppercase tracking-wider text-muted-foreground font-semibold">
                {t('edit.highlightLabel')}
            </span>
            {isSaving && <Clock className="w-3 h-3 text-muted-foreground animate-spin" />}
        </div>
        <textarea
            value={editedHighlight}
            onChange={(e) => setEditedHighlight(e.target.value)}
            onBlur={handleSaveHighlight}
            className="w-full bg-background border border-input rounded-sm p-sm text-base text-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-ring resize-none font-serif"
            rows={6}
            autoFocus
        />
        <p className="text-overline text-muted-foreground mt-xs">{t('edit.saveHint')}</p>
    </div>
) : (
    <div className="relative group">
        <blockquote className="text-lg md:text-xl font-serif italic text-foreground leading-relaxed text-justify">
            "{currentHighlight.text}"
        </blockquote>
        {/* edit button */}
    </div>
)}
```

**New implementation (seamless):**
```tsx
{isEditingHighlight ? (
    <div className="relative">
        <textarea
            value={editedHighlight}
            onChange={(e) => {
                setEditedHighlight(e.target.value);
                // Auto-resize
                e.target.style.height = 'auto';
                e.target.style.height = `${e.target.scrollHeight}px`;
            }}
            onBlur={handleSaveHighlight}
            className="w-full text-lg md:text-xl font-serif italic text-foreground leading-relaxed text-justify bg-transparent border border-dashed border-border/50 rounded-sm resize-none focus:outline-none focus:ring-0 -m-1 p-1"
            autoFocus
            onFocus={(e) => {
                // Set initial height on focus
                e.target.style.height = 'auto';
                e.target.style.height = `${e.target.scrollHeight}px`;
            }}
        />
        {isSaving && (
            <div className="absolute top-0 right-0">
                <Clock className="w-3 h-3 text-muted-foreground animate-spin" />
            </div>
        )}
    </div>
) : (
    <div className="relative group">
        <blockquote className="text-lg md:text-xl font-serif italic text-foreground leading-relaxed text-justify">
            "{currentHighlight.text}"
        </blockquote>
        {/* edit button unchanged */}
    </div>
)}
```

Key changes:
- Remove outer `bg-muted border border-border rounded-md p-md` wrapper
- Remove header with label and hint text
- Textarea classes match blockquote exactly: `text-lg md:text-xl font-serif italic text-foreground leading-relaxed text-justify`
- Add `bg-transparent` for no background change
- Add `border border-dashed border-border/50` for subtle edit indicator
- Remove `rows={6}` -- use auto-resize instead
- Add `-m-1 p-1` to offset the dashed border (no layout shift)
- Add `resize-none focus:outline-none focus:ring-0` for clean appearance
- Add auto-resize on both onChange and onFocus
- Move saving indicator to absolute position in corner
  </action>
  <verify>Visual check: enter edit mode and verify text stays in same position. Textarea should auto-resize with content.</verify>
  <done>Highlight textarea visually matches blockquote, auto-resizes, and has subtle dashed border indicator.</done>
</task>

<task type="auto">
  <name>Task 2: Implement seamless note editing</name>
  <files>pages/StudySession.tsx</files>
  <action>
Find the note editing section (around lines 567-625).

**Current implementation (jarring container change):**
```tsx
{isEditingNote ? (
    <div className="bg-muted border border-border rounded-md p-md">
        <div className="flex items-center justify-between mb-xs">
            <span className="text-overline uppercase tracking-wider text-muted-foreground font-semibold">
                {t('edit.noteLabel')}
            </span>
            {isSaving && <Clock className="w-3 h-3 text-muted-foreground animate-spin" />}
        </div>
        <textarea
            value={editedNote}
            onChange={(e) => setEditedNote(e.target.value)}
            onBlur={handleSaveNote}
            className="w-full bg-background border border-input rounded-sm p-sm text-body text-foreground focus:outline-none focus:ring-1 focus:ring-ring focus:border-ring resize-none"
            rows={6}
            placeholder={t('edit.notePlaceholder')}
            autoFocus
        />
        <p className="text-overline text-muted-foreground mt-xs">{t('edit.saveHint')}</p>
    </div>
) : (
    // display mode...
)}
```

**New implementation (seamless):**
```tsx
{isEditingNote ? (
    <div className="relative">
        <textarea
            value={editedNote}
            onChange={(e) => {
                setEditedNote(e.target.value);
                // Auto-resize
                e.target.style.height = 'auto';
                e.target.style.height = `${e.target.scrollHeight}px`;
            }}
            onBlur={handleSaveNote}
            placeholder={t('edit.notePlaceholder')}
            className="w-full text-lg md:text-xl font-serif text-foreground leading-relaxed text-justify whitespace-pre-wrap bg-transparent border border-dashed border-border/50 rounded-sm resize-none focus:outline-none focus:ring-0 -m-1 p-1"
            autoFocus
            onFocus={(e) => {
                // Set initial height on focus
                e.target.style.height = 'auto';
                e.target.style.height = `${e.target.scrollHeight}px`;
            }}
        />
        {isSaving && (
            <div className="absolute top-0 right-0">
                <Clock className="w-3 h-3 text-muted-foreground animate-spin" />
            </div>
        )}
    </div>
) : (
    // display mode unchanged...
)}
```

Key changes (same pattern as highlight):
- Remove outer `bg-muted border border-border rounded-md p-md` wrapper
- Remove header with label and hint text
- Textarea classes match note div exactly: `text-lg md:text-xl font-serif text-foreground leading-relaxed text-justify whitespace-pre-wrap`
- Note does NOT have `italic` (unlike highlight)
- Add `bg-transparent border border-dashed border-border/50` for subtle edit indicator
- Remove `rows={6}` -- use auto-resize instead
- Add `-m-1 p-1` to offset the dashed border
- Add `resize-none focus:outline-none focus:ring-0`
- Add auto-resize on both onChange and onFocus
- Keep placeholder for empty notes
- Move saving indicator to absolute position
  </action>
  <verify>Visual check: enter note edit mode and verify text stays in same position. Textarea should auto-resize.</verify>
  <done>Note textarea visually matches note div, auto-resizes, and has subtle dashed border indicator.</done>
</task>

<task type="auto">
  <name>Task 3: Add minimum height for empty textareas</name>
  <files>pages/StudySession.tsx</files>
  <action>
When editing an empty note, the textarea needs a minimum height so users can see where to type.

For both textareas, add a `style` prop with `minHeight`:

**Highlight textarea:**
```tsx
<textarea
    // ... existing props
    style={{ minHeight: '3rem' }}
/>
```

**Note textarea:**
```tsx
<textarea
    // ... existing props
    style={{ minHeight: '3rem' }}
/>
```

This ensures:
- Empty textareas are visible and clickable
- 3rem (48px) provides enough space for at least 2 lines
- Auto-resize still works -- minHeight just sets the floor
  </action>
  <verify>Visual check: click "Add note" on a highlight with no note. Textarea should have reasonable height, not collapse to zero.</verify>
  <done>Empty textareas have minHeight of 3rem for usability.</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run build` passes without errors
2. Visual verification in dev server:
   - Enter highlight edit mode: text appears in same position, same font
   - Enter note edit mode: text appears in same position, same font
   - Both textareas auto-resize as you type
   - Both show subtle dashed border (not jarring solid container)
   - Saving spinner appears in corner without shifting layout
   - Empty note textarea is visible and usable
</verification>

<success_criteria>
- STUDY-04: Both highlight and note editing are seamless
- Textareas match display typography exactly (font-family, size, style, alignment)
- Auto-resize works on content change
- Subtle dashed border indicates edit mode without layout shift
- Saving indicator positioned absolutely
- No TypeScript errors or visual regressions
</success_criteria>

<output>
After completion, create `.planning/phases/12-studysession-ux/12-02-SUMMARY.md`
</output>
