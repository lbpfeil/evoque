---
phase: 13-dashboard-analytics
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - types.ts
  - lib/supabaseHelpers.ts
autonomous: true
user_setup:
  - service: supabase
    status: DONE  # Applied via MCP Supabase on 2026-01-29
    why: "Add duration_ms column to review_logs table"
    migration_name: "add_duration_ms_to_review_logs"

must_haves:
  truths:
    - "ReviewLog type includes optional durationMs field"
    - "Supabase helpers convert duration_ms <-> durationMs correctly"
    - "Existing review logs without duration_ms load without errors"
  artifacts:
    - path: "types.ts"
      provides: "ReviewLog interface with durationMs"
      contains: "durationMs?: number"
    - path: "lib/supabaseHelpers.ts"
      provides: "Updated review log converters"
      contains: "duration_ms"
  key_links:
    - from: "types.ts"
      to: "lib/supabaseHelpers.ts"
      via: "ReviewLog interface import"
      pattern: "durationMs.*duration_ms"
---

<objective>
Add duration_ms field to ReviewLog type and Supabase converters for time tracking.

Purpose: Enable time tracking in review sessions by preparing the data layer to store duration in milliseconds.
Output: Updated types.ts and supabaseHelpers.ts ready to accept duration data from StudySession.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-dashboard-analytics/13-RESEARCH.md

@types.ts
@lib/supabaseHelpers.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update ReviewLog type</name>
  <files>types.ts</files>
  <action>
Add `durationMs?: number` field to the ReviewLog interface.

The field must be optional (nullable) for backward compatibility with existing review logs that don't have duration data.

Location: Find the ReviewLog interface (around line 86-93) and add the new field after `easeFactor`.

```typescript
export interface ReviewLog {
  id: string;
  cardId: string;
  quality: number;
  reviewedAt: string;
  interval: number;
  easeFactor: number;
  durationMs?: number;  // NEW: Time taken to respond in milliseconds
}
```
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>ReviewLog interface has durationMs?: number field</done>
</task>

<task type="auto">
  <name>Task 2: Update Supabase helpers</name>
  <files>lib/supabaseHelpers.ts</files>
  <action>
Update both toSupabaseReviewLog and fromSupabaseReviewLog functions to handle the duration_ms field.

1. In `toSupabaseReviewLog` (around line 136-144):
   - Add `duration_ms: log.durationMs || null` to the return object

```typescript
export const toSupabaseReviewLog = (log: any, userId: string) => ({
    id: log.id,
    user_id: userId,
    card_id: log.cardId,
    quality: log.quality,
    reviewed_at: log.reviewedAt,
    interval_days: log.interval,
    ease_factor: log.easeFactor,
    duration_ms: log.durationMs || null  // NEW
});
```

2. In `fromSupabaseReviewLog` (around line 146-153):
   - Add `durationMs: row.duration_ms` to the return object

```typescript
export const fromSupabaseReviewLog = (row: any) => ({
    id: row.id,
    cardId: row.card_id,
    quality: row.quality,
    reviewedAt: row.reviewed_at,
    interval: row.interval_days,
    easeFactor: row.ease_factor,
    durationMs: row.duration_ms  // NEW
});
```

Note: The `|| null` in toSupabaseReviewLog ensures that undefined values are converted to null for Supabase. The fromSupabaseReviewLog returns undefined if row.duration_ms is null (JavaScript behavior).
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Both toSupabaseReviewLog and fromSupabaseReviewLog handle duration_ms field</done>
</task>

</tasks>

<verification>
1. TypeScript compilation succeeds: `npx tsc --noEmit`
2. No import errors in dependent files
3. App starts without errors: `npm run dev` (manual check)
</verification>

<success_criteria>
- ReviewLog type has durationMs?: number field
- toSupabaseReviewLog includes duration_ms in output
- fromSupabaseReviewLog maps duration_ms to durationMs
- Backward compatible: existing logs without duration load correctly
</success_criteria>

<output>
After completion, create `.planning/phases/13-dashboard-analytics/13-01-SUMMARY.md`
</output>
