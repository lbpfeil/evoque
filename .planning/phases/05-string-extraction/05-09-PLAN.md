# Plan: 05-09 Error Messages and Validation

---
phase: 05-string-extraction
plan: 09
type: execute
wave: 6
depends_on: [05-01, 05-07]
files_modified:
  - components/StoreContext.tsx
  - pages/Settings.tsx
  - pages/Login.tsx
  - public/locales/pt-BR/errors.json
autonomous: true

must_haves:
  truths:
    - "All alert() messages display in Portuguese"
    - "All confirm() dialogs display in Portuguese"
    - "Login error messages display in Portuguese"
  artifacts:
    - path: "public/locales/pt-BR/errors.json"
      provides: "Comprehensive Portuguese error translations"
      contains: "validation"
  key_links:
    - from: "pages/Login.tsx"
      to: "public/locales/pt-BR/errors.json"
      via: "useTranslation hook"
      pattern: "t\\(['\"]errors:"
---

<objective>
Ensure all error messages and validation strings are translated using the errors namespace.

Purpose: Complete error message translation - Requirement TRANS-09.
Output: Fully translated error messages in errors.json
</objective>

<execution_context>
@C:\Users\lbp80\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\lbp80\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@pages/Login.tsx
@pages/Settings.tsx
@public/locales/pt-BR/errors.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Audit and update error messages in Login.tsx and Settings.tsx</name>
  <files>pages/Login.tsx, pages/Settings.tsx</files>
  <action>
Audit Login.tsx for error messages:
- "Verifique seu email para confirmar o cadastro!" -> t('auth:signup.verifyEmail')
- "Erro ao autenticar" -> t('errors:auth.generic')
- Any error messages from Supabase auth

Audit Settings.tsx for error messages (if not already done):
- File validation errors
- Upload errors
- confirm() dialog messages -> Use t() with errors namespace
- alert() calls -> Use t() with errors namespace

For confirm() dialogs that need translation, use translated strings from components:
```typescript
const { t } = useTranslation('errors');
if (window.confirm(t('tag.cascadeDelete'))) {
  // proceed
}
```

Note: StoreContext.tsx is not a React component, so useTranslation hook cannot be used directly. Error messages in StoreContext should be error codes that are translated at the component level where they're displayed.
  </action>
  <verify>grep -n "t('errors" pages/Login.tsx pages/Settings.tsx</verify>
  <done>Login.tsx and Settings.tsx error handling uses translated strings</done>
</task>

<task type="auto">
  <name>Task 2: Update errors.json with comprehensive error coverage</name>
  <files>public/locales/pt-BR/errors.json</files>
  <action>
Update public/locales/pt-BR/errors.json with comprehensive error coverage:
```json
{
  "validation": {
    "required": "Este campo e obrigatorio",
    "emailInvalid": "Email invalido",
    "passwordShort": "A senha deve ter pelo menos {{min}} caracteres",
    "passwordMismatch": "As senhas nao coincidem",
    "fileTooLarge": "O arquivo deve ter menos de {{max}}MB",
    "fileInvalid": "Tipo de arquivo invalido",
    "imageRequired": "Por favor, envie um arquivo de imagem",
    "fileTooLarge2MB": "O arquivo deve ter menos de 2MB",
    "fileTooLarge5MB": "O arquivo deve ter menos de 5MB"
  },
  "network": {
    "offline": "Voce esta offline",
    "timeout": "A requisicao expirou",
    "serverError": "Erro no servidor",
    "connectionFailed": "Falha na conexao",
    "retry": "Tentar novamente"
  },
  "auth": {
    "invalidCredentials": "Email ou senha incorretos",
    "emailTaken": "Este email ja esta em uso",
    "sessionExpired": "Sua sessao expirou",
    "unauthorized": "Acesso nao autorizado",
    "generic": "Erro ao autenticar"
  },
  "import": {
    "parseError": "Erro ao processar arquivo",
    "noHighlights": "Nenhum destaque encontrado no arquivo",
    "unsupportedFormat": "Formato de arquivo nao suportado",
    "notLoggedIn": "Voce precisa estar logado para importar arquivos",
    "invalidFileType": "Por favor, envie um arquivo .txt, .pdf ou .tsv"
  },
  "upload": {
    "avatarFailed": "Falha ao enviar avatar: {{message}}",
    "coverFailed": "Falha ao enviar capa: {{message}}"
  },
  "tag": {
    "cascadeDelete": "Isso excluira esta tag e TODAS as suas sub-tags. Tem certeza?",
    "confirmDelete": "Tem certeza que deseja excluir esta tag?"
  },
  "book": {
    "applyGlobalConfirm": "Aplicar configuracoes globais a todos os livros?\n\nIsso removera configuracoes personalizadas de todos os livros."
  },
  "generic": {
    "unknown": "Ocorreu um erro inesperado",
    "tryAgain": "Por favor, tente novamente",
    "contactSupport": "Se o problema persistir, entre em contato"
  }
}
```
  </action>
  <verify>npm run dev -- --open & sleep 5 && echo "Test error scenarios to verify Portuguese messages"</verify>
  <done>errors.json contains comprehensive error coverage, all error paths show Portuguese messages</done>
</task>

</tasks>

<verification>
- [ ] All alert() messages display in Portuguese
- [ ] All confirm() dialogs display in Portuguese
- [ ] Login error messages display in Portuguese
- [ ] Import error messages display in Portuguese
- [ ] Upload error messages display in Portuguese
- [ ] errors.json contains comprehensive error coverage
- [ ] No English error messages visible in UI
</verification>

<success_criteria>
- errors.json fully populated with all error messages
- Login.tsx error handling uses translated strings
- Settings.tsx validation uses translated strings
- confirm() dialogs use translated strings
- All user-facing errors translated
</success_criteria>

<output>
After completion, create `.planning/phases/05-string-extraction/05-09-SUMMARY.md`
</output>
