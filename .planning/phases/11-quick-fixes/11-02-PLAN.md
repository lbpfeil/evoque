---
phase: 11-quick-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - components/StudyHeatmap.tsx
autonomous: true

must_haves:
  truths:
    - "Heatmap cells are larger and more visually distinct"
    - "Heatmap is wider, showing more weeks of data"
    - "Today's reviews appear on the correct date in heatmap (timezone-safe)"
  artifacts:
    - path: "components/StudyHeatmap.tsx"
      provides: "Larger heatmap cells and timezone-safe date handling"
      contains: "w-3 h-3"
  key_links:
    - from: "calculateStreaks function"
      to: "aggregateReviewsByDate function"
      via: "consistent local date formatting"
      pattern: "formatLocalDate"
---

<objective>
Increase heatmap size and fix timezone bug

Purpose: Make heatmap more visually prominent and ensure reviews are counted on correct local dates
Output: StudyHeatmap.tsx with larger cells/circles and timezone-safe date calculations
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-quick-fixes/11-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Increase heatmap cell size (FIX-03)</name>
  <files>components/StudyHeatmap.tsx</files>
  <action>
In StudyHeatmap.tsx, increase the heatmap cell sizes for better visibility.

1. Find the weekWidth constant (research indicates line 233-241):
   ```tsx
   const weekWidth = 12; // 10px cell + 2px gap
   ```
   Change to:
   ```tsx
   const weekWidth = 16; // 14px cell + 2px gap
   ```

2. Find day label cells (research indicates line 339):
   ```tsx
   <div className="w-2.5 h-2.5 text-[8px] ..."
   ```
   Change to:
   ```tsx
   <div className="w-3.5 h-3.5 text-[10px] ..."
   ```

3. Find heatmap cells (research indicates line 352):
   ```tsx
   <div className="w-2.5 h-2.5 rounded-sm ..."
   ```
   Change to:
   ```tsx
   <div className="w-3.5 h-3.5 rounded-sm ..."
   ```

4. Check if there's a gap value that needs updating (likely gap-0.5 or similar). If gap is 2px, keep it. The larger cells will naturally make the heatmap wider.

The size increase from 10px to 14px makes circles ~40% larger, significantly improving visibility.
  </action>
  <verify>
Run `npm run dev` and navigate to a page with the heatmap (Dashboard or wherever it appears). Verify:
1. Heatmap cells are noticeably larger than before
2. Heatmap occupies more horizontal space
3. Day labels (S, T, Q, etc.) are readable
4. Hover tooltips still work correctly
5. Color intensities still visually distinct
  </verify>
  <done>FIX-03 complete: Heatmap is wider with larger, more visible circles</done>
</task>

<task type="auto">
  <name>Task 2: Fix timezone bug in heatmap (FIX-04)</name>
  <files>components/StudyHeatmap.tsx</files>
  <action>
In StudyHeatmap.tsx, fix the timezone bug in the `calculateStreaks` function.

1. First, check if there's already a `formatLocalDate` helper function. If not, add one at the top of the file (inside the component or as a utility):
   ```tsx
   function formatLocalDate(date: Date): string {
     const year = date.getFullYear();
     const month = String(date.getMonth() + 1).padStart(2, '0');
     const day = String(date.getDate()).padStart(2, '0');
     return `${year}-${month}-${day}`;
   }
   ```

2. Find the `calculateStreaks` function (research indicates lines 103-171). Look for this pattern:
   ```tsx
   const todayKey = today.toISOString().split('T')[0];
   ```
   This is the BUG - `toISOString()` converts to UTC, causing timezone issues.

3. Replace ALL instances of `.toISOString().split('T')[0]` with `formatLocalDate()`:
   ```tsx
   const todayKey = formatLocalDate(today);
   const yesterdayKey = formatLocalDate(yesterday);
   // ... any other date key generations
   ```

4. Verify that `aggregateReviewsByDate` already uses local date formatting. It should - the fix is to make `calculateStreaks` consistent with it.

This ensures reviews done at 11pm local time don't show as "tomorrow" due to UTC conversion.
  </action>
  <verify>
Run `npm run dev`. Do a study review (or check existing data). Verify:
1. Today's reviews appear under today's date cell in the heatmap
2. The current streak count is accurate (if you reviewed today, streak should reflect it)
3. No JavaScript errors in console related to date handling
4. Test by checking browser timezone vs UTC - if they differ by multiple hours, this is especially important to verify
  </verify>
  <done>FIX-04 complete: Heatmap counts dates correctly using local timezone</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run build` succeeds without errors
2. Heatmap cells are visibly larger (~14px instead of ~10px)
3. Heatmap occupies more width
4. Timezone bug verified fixed (today's reviews show on today)
</verification>

<success_criteria>
- FIX-03: Heatmap cells are 14px (w-3.5 h-3.5) instead of 10px
- FIX-04: `calculateStreaks` uses `formatLocalDate()` instead of `toISOString()`
- No visual regressions in heatmap rendering
- No date calculation bugs
</success_criteria>

<output>
After completion, create `.planning/phases/11-quick-fixes/11-02-SUMMARY.md`
</output>
