---
phase: 03-critical-pages
plan: 06
type: execute
wave: 2
depends_on: [03-05]
files_modified: [pages/StudySession.tsx]
autonomous: false

must_haves:
  truths:
    - "Response buttons keep explicit SRS colors (red/amber/blue/green)"
    - "Tag selector modal uses semantic tokens for backdrop and container"
    - "All state screens use consistent semantic tokens"
  artifacts:
    - path: "pages/StudySession.tsx"
      provides: "Complete StudySession with semantic tokens and preserved intentional colors"
      contains: "bg-red-500"
  key_links:
    - from: "pages/StudySession.tsx"
      to: "SRS response buttons"
      via: "button onClick handlers"
      pattern: "handleResponse\\([1-4]\\)"
---

<objective>
Complete StudySession.tsx migration: tag selector modal backdrop and verify all SRS colors are preserved.

Purpose: Final step of StudySession migration. Ensures tag selector modal fits the theme while SRS conventions (response button colors, card status indicators) are NOT changed.
Output: Fully migrated StudySession.tsx ready for user final approval.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-critical-pages/03-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate tag selector modal to semantic tokens</name>
  <files>pages/StudySession.tsx</files>
  <action>
Replace hardcoded zinc colors in tag selector modal:

1. Backdrop (line 687):
   - BEFORE: `bg-black/10 dark:bg-black/30`
   - AFTER: `bg-foreground/10 dark:bg-foreground/30`

2. Tag selector container (line 693):
   - BEFORE: `bg-white dark:bg-zinc-900 ... border border-zinc-300 dark:border-zinc-700`
   - AFTER: `bg-card ... border border-border`

Note: The TagSelector component itself was already partially migrated in Phase 2. This plan only addresses the container styling in StudySession.tsx.
  </action>
  <verify>Run `npm run build` to confirm no TypeScript errors</verify>
  <done>Tag selector modal uses semantic tokens for backdrop and container</done>
</task>

<task type="auto">
  <name>Task 2: Verify SRS colors are NOT changed (audit only)</name>
  <files>pages/StudySession.tsx</files>
  <action>
This is an AUDIT task - do NOT change these colors. Verify they still exist:

1. Card status indicator colors (lines 12-18 in getCardStatus function):
   - New: `bg-blue-500` - KEEP
   - Learning: `bg-amber-500` - KEEP
   - Review: `bg-green-500` - KEEP

2. Response buttons (lines 631-662):
   - Again: `bg-red-500 dark:bg-red-600 hover:bg-red-600 dark:hover:bg-red-700` - KEEP
   - Hard: `bg-amber-500 dark:bg-amber-600 hover:bg-amber-600 dark:hover:bg-amber-700` - KEEP
   - Good: `bg-blue-500 dark:bg-blue-600 hover:bg-blue-600 dark:hover:bg-blue-700` - KEEP
   - Easy: `bg-green-500 dark:bg-green-600 hover:bg-green-600 dark:hover:bg-green-700` - KEEP

3. Tag colors (lines 452-454, 495-497):
   - Global tags: `bg-blue-500 dark:bg-blue-600` - KEEP
   - Book-specific tags: `bg-amber-500 dark:bg-amber-600` - KEEP

If any of these colors were accidentally changed in previous tasks, RESTORE them to the original values listed above.
  </action>
  <verify>
Run: `grep -n "bg-red-500\|bg-amber-500\|bg-blue-500\|bg-green-500" pages/StudySession.tsx`
Should show multiple results for response buttons, status indicators, and tags.
  </verify>
  <done>All SRS-meaningful colors verified intact</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete StudySession.tsx migration with all semantic tokens and preserved SRS colors</what-built>
  <how-to-verify>
## Final StudySession.tsx Verification

1. Run `npm run dev`
2. Navigate to http://localhost:3000/#/study
3. Start a study session with at least one card due

### Test in LIGHT mode:

**Header:**
- [ ] Back button visible and hoverable
- [ ] Card counter visible (e.g., "Card 1 / 5")
- [ ] Tag, copy, delete icons visible and hoverable
- [ ] Progress bar has subtle background

**Card Display:**
- [ ] Book title readable
- [ ] Author name slightly dimmed
- [ ] Card status dot shows correct color (blue=new, amber=learning, green=review)
- [ ] Tags show correct colors (blue=global, amber=book-specific)
- [ ] Highlight text is in SERIF font
- [ ] Edit mode shows muted background

**After Reveal:**
- [ ] Decorative divider visible
- [ ] Note text (if any) is in SERIF font
- [ ] Response buttons show correct SRS colors:
  - Again = RED
  - Hard = AMBER/ORANGE
  - Good = BLUE
  - Easy = GREEN

**Tag Selector:**
- [ ] Click tag icon in header
- [ ] Modal backdrop is visible but not too dark
- [ ] Modal container has card background

### Test in DARK mode:

Repeat all checks above in dark mode:
- [ ] All text readable
- [ ] All backgrounds adapt
- [ ] Serif font still visible
- [ ] SRS colors still correct and visible

### Edge Cases:

- [ ] Empty session ("No cards available") screen readable
- [ ] Session complete screen shows stats clearly
- [ ] Error state (if triggerable) shows red text
  </how-to-verify>
  <resume-signal>Type "approved" to complete Phase 3, or describe any remaining issues</resume-signal>
</task>

</tasks>

<verification>
## Automated Checks

```bash
npm run build

# Verify SRS colors preserved
grep -c "bg-red-500" pages/StudySession.tsx    # Should be >= 1
grep -c "bg-amber-500" pages/StudySession.tsx  # Should be >= 2 (button + tag)
grep -c "bg-blue-500" pages/StudySession.tsx   # Should be >= 2 (button + tag)
grep -c "bg-green-500" pages/StudySession.tsx  # Should be >= 2 (button + status)

# Verify font-serif preserved
grep -c "font-serif" pages/StudySession.tsx    # Should be 4
```

## Visual Verification

Final comprehensive check covering all StudySession states and elements.
</verification>

<success_criteria>
1. Tag selector modal uses bg-card and border-border
2. Response buttons keep red/amber/blue/green colors
3. Card status indicators keep blue/amber/green colors
4. Tag colors keep blue (global) and amber (book-specific)
5. font-serif preserved on 4 elements
6. User has given final approval for StudySession.tsx
</success_criteria>

<output>
After completion, create `.planning/phases/03-critical-pages/03-06-SUMMARY.md`
</output>
